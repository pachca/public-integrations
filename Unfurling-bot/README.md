# Pachca Unfurling Bot

–ë–æ—Ç –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ (unfurling) –≤ –ü–∞—á–∫–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Trello, Kaiten –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ü–∞—á–∫–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

[–°—Å—ã–ª–∫–∞](https://github.com/pachca/public-integrations) –Ω–∞ –¥—Ä—É–≥–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥–æ–π –ü–∞—á–∫–∏.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ü–∞—á–∫–µ

1. –í –ü–∞—á–∫–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" -> "–ß–∞—Ç-–±–æ—Ç—ã –∏ –í–µ–±—Ö—É–∫–∏"
2. –°–æ–∑–¥–∞–π—Ç–µ Unfurl –±–æ—Ç–∞
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ Signing secret –±–æ—Ç–∞. –û–Ω–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö
4. –î–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –ü–∞—á–∫–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É:
   ```sh
   git clone https://github.com/pachca/public-integrations.git
   cd public-integrations/Unfurling-bot
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
   ```sh
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ —Ç–æ–∫–µ–Ω—ã
   ```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
   ```sh
   bundle install
   bundle exec ruby app.rb
   ```

4. –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:4567

### –ó–∞–ø—É—Å–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker

–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞ –≤ Docker. –≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥–æ–π–¥–µ—Ç, —á—Ç–æ–±—ã –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å Ruby –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏ —Å—Ä–∞–∑—É –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:

#### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ. –ï—Å–ª–∏ –Ω–µ—Ç, —Å–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ Docker.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ Docker –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–∞–º–∏ `docker --version` –∏ `docker-compose --version`

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```sh
   cp .env.example .env
   ```

3. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ª—é–±–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

#### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–æ—Ç–æ–º:
   ```sh
   docker-compose up -d
   ```
   –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–¥–µ–ª–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:
   - –°–æ–±–µ—Ä—ë—Ç Docker-–æ–±—Ä–∞–∑ —Å –±–æ—Ç–æ–º
   - –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
   - –ü—Ä–æ–±—Ä–æ—Å–∏—Ç –ø–æ—Ä—Ç 4567 –Ω–∞ –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   http://localhost:4567/health
   ```
   –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å JSON-–æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –±–æ—Ç–∞

#### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL —Å –ø–æ–º–æ—â—å—é ngrok

1. **–í–∞–∂–Ω–æ**: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ü–∞—á–∫–æ–π –±–æ—Ç—É –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π URL, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ –Ω–µ–≥–æ –≤–µ–±—Ö—É–∫–∏. –ü—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ Docker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL.

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok** –Ω–∞ –≤–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É (–Ω–µ –≤ Docker):
   - –î–ª—è Mac: `brew install ngrok` –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å [ngrok.com](https://ngrok.com/download)
   - –î–ª—è Windows: —Å–∫–∞—á–∞–π—Ç–µ —Å [ngrok.com](https://ngrok.com/download)
   - –î–ª—è Linux: `sudo snap install ngrok` –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å [ngrok.com](https://ngrok.com/download)

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ** (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º Docker):
   ```sh
   ngrok http 4567
   ```
   –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ ngrok –ø–æ–∫–∞–∂–µ—Ç –≤–∞–º URL –≤–∏–¥–∞ `https://xxxx-xx-xx-xxx-xx.ngrok-free.app`

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±—Ö—É–∫ –≤ –ü–∞—á–∫–µ**, —É–∫–∞–∑–∞–≤ URL –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
   ```
   https://xxxx-xx-xx-xxx-xx.ngrok-free.app/v1/unfurl
   ```
   
   > **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π URL ngrok –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ. –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ URL –Ω—É–∂–Ω–∞ –ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ ngrok –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥.

#### –®–∞–≥ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º

1. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
   ```sh
   docker-compose logs -f
   ```

2. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–æ—Ç–∞:
   ```sh
   docker-compose down
   ```

3. –î–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫):
   ```sh
   docker-compose restart
   ```

4. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞:
   ```sh
   docker-compose ps
   ```



## –î–µ–ø–ª–æ–π –¥–ª—è –ø—Ä–æ–¥–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Vercel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞)

1. –ï—Å–ª–∏ —É –≤–∞—Å –µ—â–µ –Ω–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞ Vercel, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ [vercel.com](https://vercel.com)

2. –î–∞–ª—å—à–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ Vercel –∏–∑ GitHub –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ò—Ö –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞, –∞ —Ç–∞–∫–∂–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "Settings" -> "Environment Variables":
   - `UNFURL_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ API –ü–∞—á–∫–∏
   - `PACHCA_WEBHOOK_SECRET` - Signing secret –±–æ—Ç–æ–≤ –≤ –ü–∞—á–∫–µ
   - `PACHCA_API_TOKEN` - —Ç–æ–∫–µ–Ω —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –ü–∞—á–∫–∏
   - –î—Ä—É–≥–∏–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`TRELLO_KEY`, `TRELLO_TOKEN`, `KAITEN_TOKEN` –∏ —Ç.–¥.)

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±—Ö—É–∫ –≤ –ü–∞—á–∫–µ, —É–∫–∞–∑–∞–≤ URL –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –ø—É—Ç–µ–º `/unfurl` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://your-app.vercel.app/unfurl`)

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –±–µ—Å—Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Å—Ä–µ–¥–∞–º**: –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É –≤ Vercel –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –±–µ—Å—Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ STDOUT –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π, –¥–æ—Å—Ç—É–ø–Ω–æ–π —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–µ–ø–ª–æ–π –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (Linux)

–£ –≤–∞—Å –µ—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –±–æ—Ç–∞ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ:

#### –í–∞—Ä–∏–∞–Ω—Ç 2.1: –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Ruby –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ Docker Compose –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```sh
   # –î–ª—è Ubuntu/Debian
   sudo apt update
   sudo apt install docker.io docker-compose
   sudo systemctl enable docker
   sudo systemctl start docker
   ```

2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```sh
   git clone https://github.com/pachca/public-integrations.git
   cd public-integrations/Unfurling-bot
   cp .env.example .env
   nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   ```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ `docker-compose.yml` (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):
   ```yaml
   ports:
     - "80:8080"  # –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 80
   ```

4. **–ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º**

   - **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:**
     –ö–æ–º–∞–Ω–¥–∞ `docker-compose up -d` —Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–æ—Ç–æ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (`-d` –æ–∑–Ω–∞—á–∞–µ—Ç detached).
     ```sh
     docker-compose up -d
     ```

   - **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (–∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç—ã):**
     –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–µ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–æ—Ç–æ–º, –∫–æ–≥–¥–∞ –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ü–∞—á–∫–∏.
     ```sh
     # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)
     docker-compose logs -f

     # –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤
     docker-compose logs --tail=200
     ```

   - **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
     –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –í –∫–æ–ª–æ–Ω–∫–µ `State` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Up`.
     ```sh
     docker-compose ps
     ```

   - **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ:**
     ```sh
     # –ü—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ docker-compose start)
     docker-compose stop

     # –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–∫–ª—é—á–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º)
     docker-compose down
     ```

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏**
   –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:
   ```sh
   # 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
   # cd /–ø—É—Ç—å/–∫/–≤–∞—à–µ–º—É/–ø—Ä–æ–µ–∫—Ç—É/public-integrations/Unfurling-bot

   # 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   docker-compose down

   # 3. –°–∫–∞—á–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   git pull

   # 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é, –ø–µ—Ä–µ—Å–æ–±—Ä–∞–≤ –æ–±—Ä–∞–∑ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
   docker-compose up -d --build
   ```
   –§–ª–∞–≥ `--build` –∑–∞—Å—Ç–∞–≤–∏—Ç Docker Compose –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑, –µ—Å–ª–∏ –≤ –∫–æ–¥–µ –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

6. **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ Docker –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞**
   –ß—Ç–æ–±—ã Docker –∏ –≤–∞—à–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ `unless-stopped` –∏–ª–∏ `always`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞:
   ```sh
   sudo systemctl enable docker
   ```

7. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∏ SSL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)**
   –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä Nginx –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ (reverse proxy) –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç Let's Encrypt. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç —Ä–∞–±–æ—Ç—É –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –ø–æ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É `https://`. –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.

#### –í–∞—Ä–∏–∞–Ω—Ç 2.2: –ë–µ–∑ Docker (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Ruby)

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞ –±–µ–∑ Docker:

{{ ... }}
   ```sh
   # –î–ª—è Ubuntu/Debian
   sudo apt update
   sudo apt install git curl libssl-dev libreadline-dev zlib1g-dev autoconf bison build-essential
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ rbenv –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ Ruby
   git clone https://github.com/rbenv/rbenv.git ~/.rbenv
   echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
   echo 'eval "$(rbenv init -)"' >> ~/.bashrc
   source ~/.bashrc
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ruby-build
   git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ruby 3.2.0
   rbenv install 3.2.0
   rbenv global 3.2.0
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bundler
   gem install bundler
   ```

2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```sh
   git clone https://github.com/pachca/public-integrations.git
   cd public-integrations/Unfurling-bot
   bundle install
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```sh
   cp .env.example .env
   nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   ```

4. –°–æ–∑–¥–∞–π—Ç–µ systemd —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:
   ```sh
   sudo nano /etc/systemd/system/pachca-unfurl.service
   ```
   
   –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
   ```
   [Unit]
   Description=Pachca Unfurling Bot
   After=network.target
   
   [Service]
   Type=simple
   User=your_username
   WorkingDirectory=/path/to/public-integrations/Unfurling-bot
   ExecStart=/home/your_username/.rbenv/shims/bundle exec ruby app.rb -p 4567 -e production
   Restart=always
   Environment=RACK_ENV=production
   EnvironmentFile=/path/to//path/to/public-integrations/Unfurling-bot/.env
   
   [Install]
   WantedBy=multi-user.target
   ```

5. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
   ```sh
   sudo systemctl daemon-reload
   sudo systemctl enable pachca-unfurl
   sudo systemctl start pachca-unfurl
   ```

6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –∫–∞–∫ –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –∏ SSL —Å Let's Encrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞).

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å—Å—ã–ª–æ–∫

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `app.rb`:

```ruby
def self.your_service_handler(url)
  # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  api_token = ENV['YOUR_SERVICE_TOKEN']
  raise 'No YOUR_SERVICE_TOKEN in ENV' unless api_token
  
  # –ü–∞—Ä—Å–∏–Ω–≥ URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
  match = url.match(%r{your-service\.com/([a-zA-Z0-9]+)})
  raise 'Invalid URL format' unless match
  item_id = match[1]
  
  # –ó–∞–ø—Ä–æ—Å –∫ API —Å–µ—Ä–≤–∏—Å–∞
  api_url = "https://api.your-service.com/items/#{item_id}"
  uri = URI(api_url)
  req = Net::HTTP::Get.new(uri)
  req['Authorization'] = "Bearer #{api_token}"
  req['Accept'] = 'application/json'
  
  res = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) { |http| http.request(req) }
  raise "API error: #{res.code}" unless res.code == '200'
  
  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
  data = JSON.parse(res.body)
  title = data['title'] || 'Item Title'
  description = data['description'] || 'No description'
  
  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  {
    title: title,
    url: url,
    description: description,
    icon: 'üìÑ'
  }
end
```

2. –î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ `services.yml`:

```yaml
- name: your_service
  match: "your-service\\.com"
  handler: "your_service_handler"
```

3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:

```
YOUR_SERVICE_TOKEN=your_api_token_here
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

–ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç `/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/health`:

```bash
curl https://your-bot-url.com/health
```

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```json
{
  "status": "ok",
  "version": "1.1.0",
  "environment": "production",
  "timestamp": "2025-06-02T16:57:37+00:00",
  "services": ["trello", "kaiten"],
  "checks": {
    "environment_variables": {
      "UNFURL_BOT_TOKEN": true,
      "UNFURL_SIGNING_SECRET": true,
      "TRELLO_KEY": true,
      "TRELLO_TOKEN": true,
      "KAITEN_TOKEN": true
    },
    "log_file_writable": true
  }
}
```

–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —Ä–∞–≤–µ–Ω `"ok"`, –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `"error"`, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª `checks` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –≤–µ–¥–µ—Ç –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª `unfurl.log` (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `LOG_FILE`). –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è, —Å–æ—Ö—Ä–∞–Ω—è—è –¥–æ 10 —Ñ–∞–π–ª–æ–≤ –ø–æ 1 –ú–ë –∫–∞–∂–¥—ã–π.

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

```bash
tail -f unfurl.log
```
### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|------|-------------|
| `/` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞ |
| `/health` | GET | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞ |
| `/unfurl` | POST | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ unfurling |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ –≤ –ü–∞—á–∫–µ

–ü—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –≤–µ–±—Ö—É–∫–∞ –≤ –ü–∞—á–∫–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```
https://your-bot-url.com/unfurl
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ –≤ –∫–æ–¥–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ü–∞—á–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
